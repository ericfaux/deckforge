import{j as e,o as E,p as I}from"./modals-DwT-_xKp.js";import{r as N,a5 as M,ad as P,a8 as F,C as U,u,X as D}from"./vendor-ui-Cq8k3voL.js";import"./vendor-supabase-CoxeBSpk.js";function S(c,r,h){return"#"+[c,r,h].map(d=>{const o=d.toString(16);return o.length===1?"0"+o:o}).join("")}function T(c,r){return Math.sqrt(Math.pow(c.r-r.r,2)+Math.pow(c.g-r.g,2)+Math.pow(c.b-r.b,2))}async function A(c,r=6){return new Promise((h,d)=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{try{const l=document.createElement("canvas"),n=l.getContext("2d");if(!n){d(new Error("Could not get canvas context"));return}const j=Math.min(1,200/Math.max(o.width,o.height));l.width=o.width*j,l.height=o.height*j,n.drawImage(o,0,0,l.width,l.height);const f=n.getImageData(0,0,l.width,l.height).data,g=[];for(let t=0;t<f.length;t+=16){const x=f[t],m=f[t+1],p=f[t+2];if(f[t+3]<128)continue;const i=(x+m+p)/3;i<20||i>235||g.push({r:x,g:m,b:p})}if(g.length===0){h([]);return}let a=[];for(let t=0;t<r;t++){const x=Math.floor(Math.random()*g.length);a.push({...g[x]})}for(let t=0;t<10;t++){const x=[];for(const s of g){let i=1/0,C=0;for(let w=0;w<a.length;w++){const k=T(s,a[w]);k<i&&(i=k,C=w)}x.push(C)}const m=Array(r).fill(null).map(()=>({r:0,g:0,b:0})),p=Array(r).fill(0);for(let s=0;s<g.length;s++){const i=x[s];m[i].r+=g[s].r,m[i].g+=g[s].g,m[i].b+=g[s].b,p[i]++}for(let s=0;s<r;s++)p[s]>0&&(a[s]={r:Math.round(m[s].r/p[s]),g:Math.round(m[s].g/p[s]),b:Math.round(m[s].b/p[s])})}const b=a.filter(t=>t.r!==0||t.g!==0||t.b!==0).map(t=>S(t.r,t.g,t.b));h(b)}catch(l){d(l)}},o.onerror=()=>{d(new Error("Failed to load image"))},o.src=c})}function z({onColorSelect:c,onPaletteExtracted:r}){const[h,d]=N.useState([]),[o,l]=N.useState(null),[n,y]=N.useState(!1),[j,v]=N.useState(null),f=async a=>{var t;const b=(t=a.target.files)==null?void 0:t[0];if(b){if(!b.type.startsWith("image/")){u.error("Please upload an image file");return}y(!0);try{const x=new FileReader;x.onload=async m=>{var s;const p=(s=m.target)==null?void 0:s.result;l(p);try{const i=await A(p,6);d(i),r==null||r(i),u.success(`Extracted ${i.length} colors from image`)}catch(i){console.error("Color extraction failed:",i),u.error("Failed to extract colors")}finally{y(!1)}},x.readAsDataURL(b)}catch(x){console.error("Image upload failed:",x),u.error("Failed to process image"),y(!1)}}},g=a=>{navigator.clipboard.writeText(a),v(a),setTimeout(()=>v(null),2e3),u.success(`Copied ${a} to clipboard`)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-600 rounded-lg p-6 text-center hover:border-gray-500 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:f,className:"hidden",id:"color-extract-upload"}),e.jsx("label",{htmlFor:"color-extract-upload",className:"cursor-pointer block",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(M,{className:"w-8 h-8 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Upload an image to extract colors"}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, or GIF"})]})})]}),o&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden",children:[e.jsx("img",{src:o,alt:"Color extraction source",className:"w-full h-40 object-cover"}),n&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsxs("div",{className:"text-white flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Extracting colors..."})]})})]}),h.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-semibold text-white",children:"Extracted Palette"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[h.length," colors"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:h.map((a,b)=>e.jsxs("button",{onClick:()=>{c==null||c(a),u.success(`Selected ${a}`)},className:"group relative aspect-square rounded-lg overflow-hidden hover:ring-2 hover:ring-white transition-all",style:{backgroundColor:a},title:a,children:[e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/50 transition-colors flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-mono opacity-0 group-hover:opacity-100 transition-opacity",children:a})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),g(a)},className:"absolute top-1 right-1 bg-black/50 p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:j===a?e.jsx(F,{className:"w-3 h-3 text-green-400"}):e.jsx(U,{className:"w-3 h-3 text-white"})})]},b))}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx(E,{size:"sm",variant:"outline",onClick:()=>{const a=h.join(", ");navigator.clipboard.writeText(a),u.success("Copied all colors to clipboard")},className:"flex-1",children:"Copy All"}),e.jsx(E,{size:"sm",variant:"outline",onClick:()=>{d([]),l(null)},className:"flex-1",children:"Clear"})]})]})]})}function q({isOpen:c,onClose:r}){const{updateObject:h,selectedId:d,objects:o}=I();if(!c)return null;const l=n=>{d?o.find(j=>j.id===d)&&(h(d,{fill:n}),u.success(`Applied ${n} to selected object`)):(navigator.clipboard.writeText(n),u.success(`Copied ${n} to clipboard`))};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:r,children:e.jsxs("div",{className:"bg-gray-900 rounded-lg shadow-2xl w-full max-w-md border border-gray-700",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Color Palette Extractor"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Upload an image to extract its dominant colors"})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(D,{className:"w-5 h-5 text-gray-400"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx(z,{onColorSelect:l,onPaletteExtracted:n=>{console.log("Extracted palette:",n)}}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-800/50 rounded-lg border border-gray-700",children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-2",children:"ðŸ’¡ How to use:"}),e.jsxs("ul",{className:"text-xs text-gray-400 space-y-1",children:[e.jsx("li",{children:"â€¢ Upload any image (photo, logo, artwork)"}),e.jsxs("li",{children:["â€¢ Click a color to ",d?"apply it to your selection":"copy it"]}),e.jsx("li",{children:'â€¢ Use "Copy All" to save the entire palette'}),e.jsx("li",{children:"â€¢ Extract colors from inspiration or reference images"})]})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-700 flex justify-end",children:e.jsx("button",{onClick:r,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors text-sm",children:"Close"})})]})})}export{q as ColorExtractorModal};
